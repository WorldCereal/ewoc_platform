# helm install keycloak  bitnami/keycloak --create-namespace --namespace=keycloak -f keycloak-value.yaml
image:
  registry: docker.io
  repository: bitnami/keycloak
#  tag: VALUE_KCVERS
  debug: false

extraEnv:
# - name: KEYCLOAK_LOG_LEVEL
#   value: DEBUG
# - name: WILDFLY_LOG_LEVEL
#   value: DEBUG
# - name: ROOT_LOG_LEVEL
#   value: DEBUG
- name: PROXY_ADDRESS_FORWARDING  
  value: "true"

service:
  type: ClusterIP
  port: 80
  nodePort: 443  

auth:
  createAdminUser: true
  adminUser: admin
  tls:
    enabled: true
    autoGenerated: true

metrics:
  enabled: true
  serviceMonitor:
    enabled: false
    namespace: monitoring
    interval: 10s
    scrapeTimeout: 10s
    honorLabels: false
    additionalLabels:
      release: kube-prometheus-stack

replicaCount: 3

affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchExpressions:
        - key: app.kubernetes.io/name 
          operator: In
          values:
          - keycloak
      topologyKey: kubernetes.io/hostname

nodeSelector:
#  role: kong
  system-tag: world-cereal-system

postgresql:
  enabled: false

externalDatabase:
  host: "pgsqlha-postgresql-ha-postgresql.sysdb.svc.cluster.local."
  port: 5432
  user: postgres
  database: bn_keycloak
  password: PG_PASS

proxy: passthrough

extraEnvVars:
  - name: KEYCLOAK_LOG_LEVEL
    value: INFO
  - name: KEYCLOAK_PRODUCTION
    value: "true"
  - name: KEYCLOAK_FRONTEND_URL
    value: "https://auth.VALUE_HOSTNAME"
  - name: KC_HOSTNAME_STRICT_HTTPS
    value: "false"  
  - name: KEYCLOAK_ENABLE_TLS
    value: "true"
  - name: KEYCLOAK_EXTRA_ARGS
    value: "--auto-build -Dkeycloak.import=/config/WC-realm.json"

extraVolumeMounts:
  - name: config
    mountPath: "/config"
    readOnly: true
extraVolumes:
  - name: config
    configMap:
      name: realm-config
      items:
      - key: "WC-realm.json"
        path: "WC-realm.json"

cache:
  enabled: true
