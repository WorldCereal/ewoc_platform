MAP
    DEBUG 3
    EXTENT -180.0 -90.0 180.0 90.0
    PROJECTION
        "init=epsg:4326"
    END
    WEB
        METADATA 
            "ows_title" "worldcereal"
            "ows_onlineresource" "http://{{ include "mapserver.fullname" . }}:{{ .Values.mapserver.service.port.port }}?MAP=/usr/src/mapfiles/mapfile.map"
            "ows_srs" "EPSG:3857 EPSG:4326"
            "ows_enable_request" "*"
            "wms_feature_info_mime_type" "text/html"
            "wfs_getfeature_formatlist" "ogrgml,geojson"
        END
    END
    #  Tile status
    LAYER
        NAME "worldcereal_s2_status"
        TYPE POLYGON
        INCLUDE "includes/postgres_connection.inc.map"
        CONNECTIONTYPE postgis
        # DATA "geometry from (select (tile_id, block_id) as gid, type.name || '-' || replace(status.name, ' ', '-')  as type_status, 'EPSG:'||epsg as epsg, geometry from s2_tile LEFT OUTER JOIN status ON status.id=s2_tile.status_id LEFT OUTER JOIN type ON type.id=s2_tile.type_id) as subquery using unique gid"
        DATA "geometry from (select (tile_id, block_id) as gid, replace(status, ' ', '-')  as type_status, 'EPSG:'||epsg as epsg, geometry from s2_tiles) as subquery using unique gid"
        TILESRS "epsg"
        PROJECTION
            "init=epsg:4326"
        END
        METADATA
            "ows_title"	"worldcereal_s2_status"
        END
        CLASSITEM type_status
        CLASS
            EXPRESSION "scheduled"
            STYLE
                COLOR "#4363d880"
            END
        END
        CLASS
            EXPRESSION "processing"
            STYLE
                COLOR "#ffe11980"
            END
        END
        CLASS
            EXPRESSION "done"
            STYLE
                COLOR "#3cb44b80"
            END
        END
        CLASS
            EXPRESSION "error"
            STYLE
                COLOR "#e6194B80"
            END
        END
        CLASS
            EXPRESSION "skip"
            STYLE
                COLOR "#99999980"
            END
        END
    END
END
